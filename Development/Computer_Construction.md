# 计算机组成

## 进程和线程

### 进程和线程的区别是什么

1. 进程拥有独立的地址空间，同一进程的线程共享地址空间
2. 进程是系统分配资源的最小单位，线程是 CPU 调度和分派的基本单位
3. 进程占用系统资源，线程几乎不占用系统资源。因此进程切换需要更多的开销来保护原进程的运行环境；而线程切换几乎没有开销。
4. 进程直接的通信需要依靠各种进程间通信手段，而线程直接通信更直接，因为线程共享包括全局变量之类的数据。
5. 一个线程崩溃会导致整个进程崩溃，但是多进程程序中一个进程崩溃不会对其他进程造成影响。

### 同一进程中的线程共享哪些资源

1. 进程代码段
2. 进程 ID、进程组 ID
3. 进程公开数据（全局变量等）
4. 进程打开的文件描述符
5. 进程当前目录
6. 信号处理器/函数

### 线程独占哪些资源

1. 线程 ID
2. 一组寄存器
3. 线程栈
4. 错误返回码
5. 信号掩码

### 进程间通信的方法

1. 管道
   - 只能用于有亲缘关系的进程直接
   - 先进先出
   - 当有一端推出管道会自动关闭，当写满或读空都产生阻塞
2. 命名管道
   - 以管道文件形式存储在磁盘中，可以在任意能访问相应地址的进程间通信
   - 先进先出
   - 先读后写，除非单一进程同时读写
3. 信号
4. 消息队列
   - 存储在内核中的链表，除非内核重启或显示删除消息队列，否则将一直存在
   - 写入时不需要读出端就位
   - 比信号传递信息更多，比管道缓冲区更大
5. 信号量
   - 用于进行进程同步，包括创建、等待（P）、挂起（V）操作，操作具有原子性，一般在内核完成。
6. 套接字
   - 基于 TCP 或 UDP 进行的网际进程通信协议
7. 共享内存
   - 最快速的通信方式
   - 需要依靠其他通信方式（信号量）完成同步

### 进程调度方式有哪些

批处理系统中按算法复杂程度有四种方式

1. 先来先服务 First come first serve FCFS
   - 对短进程不好，响应时间不确定
2. 最短任务优先 Shortest Job First SJF
   - 按预估运行时长进行调度，对长任务不友好，可能导致饥饿，吞吐量高
3. 最短剩余时间优先 shortest remaining time next SRTN
   - 抢占式，对长任务不友好，可能导致饥饿
4. 最高响应比优先
   - 相应比=1+等待时间/任务预估时间。 开销可能大，非抢占，无饥饿问题

交互式系统主要有两种方法

1. 时间片轮转：  
   将就绪事务按环形排列，每个事务的时间片结束后排到队尾。为短进程提供良好的响应时间。  
   无饥饿，抢占式，开销小。  
   若时间片小会增加开销，时间片大会延迟响应时间。
2. 优先级调度：  
   按事务优先级进行调度，事务优先级按等待时间提供，以防止饥饿问题

### 什么是僵尸进程

僵尸进程是指一个子进程运行结束，而其父进程因为某些原因没有调用 wait 或 waitpid 对其资源进行回收，产生的未被终止和回收的进程。

可以通过杀死父进程，让 init 接管子进程的回收。

### 线程同步有哪些方法

1. 互斥量  
   二值信号量
2. 信号量  
   控制资源的访问线程数量
3. 事件  
   用来激活其他等待资源的线程。手动重置事件激活全部挂起线程，需要手动关闭。自动重置事件只激活一个挂起线程后自动关闭。
4. 临界区
   只有一个线程可以访问临界区

### 什么是协程

协程是一种更轻量级的用户态线程，拥有独立的上下文和栈，能够以更小的开销进行切换而不用进行内核切换。

## 系统调用

### 有哪些 IO 模型

1. 同步阻塞
2. 同步非阻塞
3. 异步
4. 信号量控制
5. IO 多路复用

### 解释 select，poll，epoll 的区别

1. select 和 poll 的区别在于 poll 的可分配空间没有限制，而 select 在初始化时会固定分配默认为 1024 位的空间。其他的查询方式几乎相同，需要对列表不断轮询

2. epoll 使用红黑树存储，查询时间更稳定，受数量影响小。epoll 可以使用边缘触发，只对发生变化的数据进行处理。epoll 只在创建 IO 时进行一次用户态到内核态的拷贝，将事件注册和监听分离，相比 select 和 poll，epoll 更加高效。

### 如何从用户态转变成内核态

1. 系统调用
2. 异常
3. 中断

### 死锁的必要条件有哪些

1. 资源互斥
2. 非抢占
3. 占用并等待
4. 资源需求链成环

### 死锁有什么解决方法

1. 破坏死锁产生的必要条件：
   - 破坏非抢占： 允许进程抢占其他进程已经占有的资源，会造成系统性能下降
   - 破坏占用并等待：
     1. 要求进程一次性申请所有需要的资源
     2. 要求进程只能在没有占用资源的情况下才能申请资源。  
        会造成性能下降，难以预测进程需要的资源，且降低系统的并发能力
   - 破坏循环等待：对资源赋予顺序编号，要求先占有小编号资源才能申请大编号资源，消除了需求成环的条件
2. 鸵鸟策略： 不进行预防和处理，在死锁危害低或发生概率低的条件下可以使用
3. 死锁避免：动态查询系统是否处于安全状态。安全状态指即使所有进程一起申请需要的资源也能通过某个执行顺序满足需求
4. 死锁解除：
   - 允许抢占
   - 杀死优先级低的进程
   - 回滚部份进程直到解除死锁

## 存储管理

### 分页和分段有什么区别

分页是将虚拟地址和物理地址按固定大小分割成块，用页表来进行查询。  
分段是将地址按进程需要分割成大小不一的段，用段首地址和段内偏移索引。

区别如下：

1. 分页没有外部碎品，有内部碎品，分段相反
2. 逻辑相邻的页地址物理不一定相邻，段地址在物理上也是连续的
3. 页按相同大小分割地址，段按需分割地址
4. 分页的目的是用于虚拟内存来获得更大的内存； 分段的目的是分割数据、程序的地址空间。

### 什么是虚拟内存

虚拟内存是一种扩大逻辑内存的手段，让一部分磁盘空间充当内存使用。  
通过页表对一部分磁盘空间进行分页，当查询时如果页不在内存中，则通过缺页异常将磁盘中的页调入内存中。

### 有哪些页置换手段

页置换算法主要分两类，一类是基于 FIFO，一类基于优先级。

1. FIFO：
   - 标准先进先出
   - 第二次机会算法，给访问过的页第二次机会，如果访问标注为 1，则将页放到队列尾部并重置标志
   - 时钟算法，将第二次机会算法的队列改为循环链表并标记头尾节点，减少了头节点移动到尾节点的开销
2. 优先级：
   - 最近未使用： 使用访问位和修改位进行标记，先置换未被访问且未被修改的，其次置换只进行修改的
   - 最近最少使用：维护时间戳或维护队列
   - 最不经常使用：替换访问次数最少的
